{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
  <style>
    @font-face {
      font-family: 'YdestreetB';
      src: url("{% static 'fonts/YdestreetB.woff2' %}") format('woff2');
      font-weight: bold;
      font-style: normal;
    }
    .font-handdrawn {
      font-family: 'YdestreetB', sans-serif;
    }
  </style>
{% endblock %}

{% block body %}
  <div class="min-h-screen bg-neutral-100 flex items-center justify-center py-12 px-4 font-handdrawn">
    <img src="{% static 'posts/images/detail/pinkhitter.png' %}" alt="스티커" class="w-36 absolute top-4 left-4 z-0 mt-50">
<img src="{% static 'posts/images/detail/bluehitter.png' %}" alt="스티커" class="w-36 absolute top-4 right-4 z-0  mt-90">
    <div class="bg-white rounded-2xl px-12 py-10 shadow-xl w-full max-w-6xl z-10 relative">
      <h1 class="text-3xl font-extrabold text-center text-black mb-10 tracking-wider">게시글 수정</h1>

      <form action="" method="POST" enctype="multipart/form-data" class="space-y-6 text-gray-800">
          {% csrf_token %}
          
          <div>
            {{ form.category }}
          </div>
          <div>
            {{ form.title }}
          </div>
          <div>
            {{ form.content }}
          </div>
          <!-- 기존 이미지들 -->
          <div id="image-container" class="flex gap-4 flex-wrap mb-6">
            {% for img in existing_images %}
              <div class="relative w-24 h-24">
                <img src="{{ img.image.url }}" alt="기존 이미지" class="w-full h-full object-cover rounded">
                <label class="absolute top-0 right-0 bg-red-500 text-white text-xs px-1 rounded-full cursor-pointer">
                  ✕
                  <input type="checkbox" name="delete_images" value="{{ img.id }}" class="hidden">
                </label>
              </div>
            {% endfor %}

            
            <!-- 새 이미지 미리보기 -->
            <div id="preview-container" class="flex gap-2 flex-wrap mt-4"></div>
          </div>
          <!-- 새 이미지 업로드 -->
          <label for="image-input" class="inline-block px-4 py-2 bg-black text-white rounded cursor-pointer">
            이미지 선택
          </label>
          <small class="ml-2 text-gray-500" id="file-count-label">0개 파일 선택됨 (최대 10장)</small>
          <input type="file" name="images" id="image-input" multiple hidden>

          <div class="text-center mt-8">
            <button type="submit"
                class="rounded-full px-8 py-3 bg-[#9AA6B2] text-white text-lg font-semibold 
                       hover:bg-[#BCCCDC] transition duration-200 shadow-md">
                수정 완료
            </button>
          </div>
      </form>
    </div>
  </div>
  <script>
  const input = document.getElementById('image-input');
  const preview = document.getElementById('preview-container');
  const fileCountLabel = document.getElementById('file-count-label');

  let selectedFiles = [];

  input.addEventListener('change', function () {
    const files = Array.from(this.files);

    if ((selectedFiles.length + files.length) > 10) {
      alert("최대 10장까지 업로드 가능합니다.");
      input.value = "";
      return;
    }

    files.forEach(file => {
      selectedFiles.push(file);

      const reader = new FileReader();
      reader.onload = function (e) {
        const container = document.createElement('div');
        container.className = 'relative w-24 h-24';

        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'w-full h-full object-cover rounded';

        const delBtn = document.createElement('button');
        delBtn.innerHTML = '✕';
        delBtn.className = 'absolute top-0 right-0 text-white bg-black bg-opacity-70 px-1 rounded-full text-sm';
        delBtn.onclick = function () {
          preview.removeChild(container);
          selectedFiles = selectedFiles.filter(f => f !== file);
          fileCountLabel.textContent = `${selectedFiles.length}개 파일 선택됨 (최대 10장)`;
        };

        container.appendChild(img);
        container.appendChild(delBtn);
        preview.appendChild(container);
      };
      reader.readAsDataURL(file);
    });

    fileCountLabel.textContent = `${selectedFiles.length}개 파일 선택됨 (최대 10장)`;
  });
</script>
{% endblock %}
